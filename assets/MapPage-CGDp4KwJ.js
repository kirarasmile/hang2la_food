import{f as C,t as x,v as S,y as i,L as g,r as u,o as D,M as N,p as R,N as F,E as n,D as s,C as r,G as E,K as T}from"./index-DwCDJex0.js";import{A as j}from"./index-DEV-fsYM.js";import{a as P,F as V}from"./useFilter-DKGlS2Dz.js";import{T as p,a as k}from"./index-BDm9Nfxt.js";import{e as W,d as M,B as y,_ as G}from"./_plugin-vue_export-helper-Bw40c_nT.js";import{A as q}from"./ArrowBackOutline-vARiAI3M.js";import"./Checkbox-CjNUI0-_.js";import"./RadioGroup-BMHkboq6.js";import"./fade-in-height-expand.cssr-BWyNFz38.js";const L={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},z=i("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),J=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1),K=[z,J],U=C({name:"RefreshOutline",render:function(f,I){return S(),x("svg",L,K)}}),H={class:"map-page"},Q={class:"page-header"},X={class:"filter-wrapper"},Y=C({__name:"MapPage",setup(B){const f=T(),I=W(),t=g(null),o=g(null),l=u([]),c=u([]),m=u(!1),_=[{id:"1",name:"海底捞火锅",tier:"hang",category:"hotpot",price_per_person:120,address:"上海市黄浦区南京东路123号",city:"上海",latitude:31.235929,longitude:121.485708,created_by:"demo",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_deleted:!1},{id:"5",name:"星巴克",tier:"elite",category:"drinks",price_per_person:40,address:"北京市朝阳区建国门外大街1号",city:"北京",latitude:39.908718,longitude:116.453472,created_by:"demo",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_deleted:!1}],{filteredRestaurants:v}=P(c);D(async()=>{await w(),await $()}),N(()=>{t.value&&t.value.destroy()}),R(v,()=>{h()},{deep:!0});async function w(){m.value=!0;try{const{data:e,error:a}=await F.from("restaurants").select("*").eq("is_deleted",!1);if(a)throw a;e&&e.length>0?c.value=e:c.value=_}catch(e){console.warn("Fetch from Supabase failed, using mock data:",e.message),c.value=_}finally{m.value=!1}}async function $(){try{const e="4c07c0ea7823f62a296cf8fe1c63a051",a="5ed5a6f819b34660b9145bf5490ea565";a&&(window._AMapSecurityConfig={securityJsCode:a}),o.value=await j.load({key:e,version:"2.0",plugins:["AMap.ToolBar","AMap.Scale","AMap.Geolocation"]}),t.value=new o.value.Map("map-container",{viewMode:"3D",zoom:11,center:[121.4737,31.2304],theme:"amap://styles/dark"}),t.value.addControl(new o.value.ToolBar),t.value.addControl(new o.value.Scale),t.value.on("moveend",()=>{}),h()}catch(e){console.error("Map init failed",e)}}function h(){!t.value||!o.value||(l.value.forEach(e=>e.setMap(null)),l.value=[],v.value.forEach(e=>{if(e.longitude&&e.latitude){const a=p[e.tier],d=new o.value.Marker({position:[e.longitude,e.latitude],title:e.name,content:b(a.emoji,a.color),offset:new o.value.Pixel(-15,-15)});d.on("click",()=>{A(e)}),d.setMap(t.value),l.value.push(d)}}),l.value.length>0&&t.value.setFitView())}function b(e,a){return`<div class="custom-marker" style="background-color: ${a}">
    <span class="marker-emoji">${e}</span>
  </div>`}function A(e){const a=`
    <div class="info-window">
      <h4>${e.name}</h4>
      <p>评级: ${p[e.tier].emoji} ${p[e.tier].label}</p>
      <p>价格: ¥${e.price_per_person}/人</p>
      <p>地址: ${e.address}</p>
    </div>
  `;new o.value.InfoWindow({content:a,offset:new o.value.Pixel(0,-30)}).open(t.value,[e.longitude,e.latitude])}function O(){f.push("/")}return(e,a)=>(S(),x("div",H,[i("header",Q,[n(r(M),{align:"center"},{default:s(()=>[n(r(y),{quaternary:"",circle:"",onClick:O},{icon:s(()=>[n(r(k),null,{default:s(()=>[n(r(q))]),_:1})]),_:1}),a[0]||(a[0]=i("h1",{class:"page-title"},"美食地图",-1))]),_:1}),n(r(M),null,{default:s(()=>[n(r(y),{secondary:"",onClick:w},{icon:s(()=>[n(r(k),null,{default:s(()=>[n(r(U))]),_:1})]),default:s(()=>[a[1]||(a[1]=E(" 刷新数据 ",-1))]),_:1})]),_:1})]),i("div",X,[n(V)]),a[2]||(a[2]=i("div",{id:"map-container",class:"map-container"},null,-1))]))}}),le=G(Y,[["__scopeId","data-v-9c6a0a10"]]);export{le as default};
