import{P as a}from"./index-CjeBonZK.js";async function c(s){try{const{data:e,error:r}=await a.from("invite_codes").select("*").eq("code",s.trim().toUpperCase()).eq("is_active",!0).single();return r||!e?{valid:!1,message:"邀请码不存在或已失效"}:e.expires_at&&new Date(e.expires_at)<new Date?{valid:!1,message:"邀请码已过期"}:e.current_uses>=e.max_uses?{valid:!1,message:"邀请码使用次数已达上限"}:{valid:!0,message:"邀请码有效",codeData:e}}catch(e){return console.error("Invite code validation error:",e),{valid:!1,message:e.message||"验证失败，请稍后重试"}}}async function u(s,e){try{const r=await c(s);if(!r.valid||!r.codeData)return{success:!1,message:r.message};const{error:t}=await a.from("invite_codes").update({current_uses:r.codeData.current_uses+1,used_by:e,used_at:new Date().toISOString()}).eq("id",r.codeData.id);if(t)throw t;return{success:!0,message:"邀请码使用成功"}}catch(r){return console.error("Use invite code error:",r),{success:!1,message:r.message||"使用邀请码失败"}}}async function d(s=1,e=7){try{const r=n(),t=new Date;t.setDate(t.getDate()+e);const{error:o}=await a.from("invite_codes").insert({code:r,max_uses:s,expires_at:t.toISOString(),is_active:!0});if(o)throw o;return{success:!0,code:r,message:"邀请码创建成功"}}catch(r){return console.error("Create invite code error:",r),{success:!1,message:r.message||"创建邀请码失败"}}}async function f(){try{const{data:s,error:e}=await a.from("invite_codes").select("*").order("created_at",{ascending:!1});if(e)throw e;return{success:!0,data:s}}catch(s){return console.error("Get invite codes error:",s),{success:!1,message:s.message}}}async function l(s){try{const{error:e}=await a.from("invite_codes").update({is_active:!1}).eq("id",s);if(e)throw e;return{success:!0}}catch(e){return console.error("Revoke invite code error:",e),{success:!1,message:e.message}}}function n(){const s="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let e="";for(let r=0;r<8;r++)e+=s.charAt(Math.floor(Math.random()*s.length));return e}export{d as c,f as g,l as r,u,c as v};
