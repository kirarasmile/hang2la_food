import{g as R,R as x,k as v,C as I,G as P,M as l,L as t,K as s,N as U,D as q,T as p,O as f,S as V}from"./index-gIUdk392.js";import{v as C,u as B}from"./inviteCode-D7VdTOaG.js";import{u as S,b as d,N as h,_ as T}from"./_plugin-vue_export-helper-FW1vkdCy.js";import{a as D,N as n}from"./FormItem-CdWP7chI.js";const F={class:"page-container"},L={class:"register-wrapper"},M=R({__name:"RegisterPage",setup(j){const c=V(),g=x(),o=S(),b=v(null),i=v(!1),m=v(!1),a=v({email:"",password:"",confirmPassword:"",nickname:"",inviteCode:""}),y={email:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±",trigger:"blur"},{type:"email",message:"è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€",trigger:["blur","change"]}],password:[{required:!0,message:"è¯·è¾“å…¥å¯†ç ",trigger:"blur"},{min:6,message:"å¯†ç è‡³å°‘6ä½",trigger:["blur","change"]}],confirmPassword:[{required:!0,message:"è¯·ç¡®è®¤å¯†ç ",trigger:"blur"},{validator:(u,e)=>e===a.value.password,message:"ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´",trigger:["blur","change"]}],nickname:[{required:!0,message:"è¯·è¾“å…¥æ˜µç§°",trigger:"blur"},{min:2,max:20,message:"æ˜µç§°é•¿åº¦ä¸º 2-20 ä¸ªå­—ç¬¦",trigger:["blur","change"]}],inviteCode:[{required:!0,message:"è¯·è¾“å…¥é‚€è¯·ç ",trigger:"blur"},{len:8,message:"é‚€è¯·ç ä¸º 8 ä½",trigger:["blur","change"]}]};async function k(){if(!a.value.inviteCode||a.value.inviteCode.length!==8){o.warning("è¯·è¾“å…¥ 8 ä½é‚€è¯·ç ");return}m.value=!0;try{const u=await C(a.value.inviteCode);u.valid?o.success("é‚€è¯·ç æœ‰æ•ˆï¼"):o.error(u.message)}finally{m.value=!1}}async function _(){var u;try{await((u=b.value)==null?void 0:u.validate())}catch{return}i.value=!0;try{const e=await C(a.value.inviteCode);if(!e.valid){o.error(e.message);return}const r=await g.signUp(a.value.email,a.value.password,a.value.nickname,a.value.inviteCode);if(r.success){if(g.user){const w=await B(a.value.inviteCode,g.user.id);w.success||console.error("Invite code deduction failed:",w.message)}o.success("æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•"),setTimeout(()=>{c.push("/login")},2e3)}else o.error(r.message)}catch(e){console.error("Register error:",e),o.error(e.message||"æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{i.value=!1}}function N(){c.push("/login")}return(u,e)=>(q(),I("div",F,[P("div",L,[l(s(U),{title:"ðŸœ æ³¨å†Œè´¦å·",class:"register-card"},{default:t(()=>[l(s(D),{ref_key:"formRef",ref:b,model:a.value,rules:y,"label-placement":"left","label-width":"80","require-mark-placement":"right-hanging"},{default:t(()=>[l(s(n),{label:"é‚®ç®±",path:"email"},{default:t(()=>[l(s(d),{value:a.value.email,"onUpdate:value":e[0]||(e[0]=r=>a.value.email=r),placeholder:"è¯·è¾“å…¥é‚®ç®±",disabled:i.value},null,8,["value","disabled"])]),_:1}),l(s(n),{label:"å¯†ç ",path:"password"},{default:t(()=>[l(s(d),{value:a.value.password,"onUpdate:value":e[1]||(e[1]=r=>a.value.password=r),placeholder:"è‡³å°‘ 6 ä½",type:"password","show-password-on":"click",disabled:i.value},null,8,["value","disabled"])]),_:1}),l(s(n),{label:"ç¡®è®¤å¯†ç ",path:"confirmPassword"},{default:t(()=>[l(s(d),{value:a.value.confirmPassword,"onUpdate:value":e[2]||(e[2]=r=>a.value.confirmPassword=r),placeholder:"å†æ¬¡è¾“å…¥å¯†ç ",type:"password","show-password-on":"click",disabled:i.value},null,8,["value","disabled"])]),_:1}),l(s(n),{label:"æ˜µç§°",path:"nickname"},{default:t(()=>[l(s(d),{value:a.value.nickname,"onUpdate:value":e[3]||(e[3]=r=>a.value.nickname=r),placeholder:"2-20 ä¸ªå­—ç¬¦",disabled:i.value},null,8,["value","disabled"])]),_:1}),l(s(n),{label:"é‚€è¯·ç ",path:"inviteCode"},{default:t(()=>[l(s(h),{style:{width:"100%"}},{default:t(()=>[l(s(d),{value:a.value.inviteCode,"onUpdate:value":e[4]||(e[4]=r=>a.value.inviteCode=r),placeholder:"8 ä½é‚€è¯·ç ",disabled:i.value,style:{flex:"1"},onInput:e[5]||(e[5]=r=>a.value.inviteCode=a.value.inviteCode.toUpperCase())},null,8,["value","disabled"]),l(s(p),{secondary:"",loading:m.value,disabled:i.value||a.value.inviteCode.length!==8,onClick:k},{default:t(()=>[...e[6]||(e[6]=[f(" éªŒè¯ ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),l(s(n),null,{default:t(()=>[l(s(h),{style:{width:"100%","justify-content":"flex-end"}},{default:t(()=>[l(s(p),{disabled:i.value,onClick:N},{default:t(()=>[...e[7]||(e[7]=[f(" å·²æœ‰è´¦å·ï¼ŸåŽ»ç™»å½• ",-1)])]),_:1},8,["disabled"]),l(s(p),{type:"primary",loading:i.value,onClick:_},{default:t(()=>[...e[8]||(e[8]=[f(" æ³¨å†Œ ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])]))}}),O=T(M,[["__scopeId","data-v-d685163c"]]);export{O as default};
