import{g as _,C as k,D as p,G as u,aN as B,P as x,O as R,k as $,t as F,J as m,N as r,K as l,S as b,aO as q,Q as g,I as w,M as z,aP as I,aQ as E,H as S,m as T,ay as G,F as H,ax as Q}from"./index-BAL0Dqcq.js";import{a as L,T as J,C as K,N as W}from"./index-BBmP7is9.js";import{u as j,N as V,_ as A}from"./_plugin-vue_export-helper-DwBdJwx7.js";import{i as O,o as Y,c as X}from"./navigation-DUNkFvzQ.js";import{N as Z}from"./RestaurantForm-D0y0KCPf.js";import{N as U,E as tt}from"./EditRestaurantModal-CXfDZ2Of.js";const et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},rt=u("path",{d:"M448 64L64 240.14h200a8 8 0 0 1 8 8V448z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),at=[rt],D=_({name:"NavigateOutline",render:function(a,e){return p(),k("svg",et,at)}}),ot={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},st=B('<path d="M39.94 178l144.16 6.12c4.61.36 23.9 1.22 23.9 25.88c0 23.8-19.16 25.33-24.14 25.88L39.94 242C27.27 241.87 16 227.56 16 210s11.27-31.87 23.94-32zm141.45 131.66L74.65 318C62 318 48 301.31 48 284.12v-.33c0-16.33 11.14-29.63 24.88-29.79l108.45 1.72C208 259 208 275.16 208 282.12c0 22.88-21.8 27.14-26.61 27.54zM90.15 32l89.37 8.93C204 41.86 208 58.18 208 68.4c0 18.39-13.41 24.6-26.67 24.6l-91 3C75.78 95.78 64 81.51 64 64s11.68-31.66 26.15-32zm-34.36 71.5l126.4 6.22c9.39.63 25.81 3 25.81 26.36c0 12-4.35 25.62-25 27.53L55.79 167.5C42.65 167.35 32 154 32 136.08s10.65-32.43 23.79-32.58z" fill="currentColor"></path><path d="M378.45 273.93A15.84 15.84 0 0 1 386 272a15.93 15.93 0 0 0-7.51 1.91z" fill="none"></path><path d="M337.86 343.22l-.13.22a2.53 2.53 0 0 1 .13-.22c20.5-35.51 30.36-55 33.82-62c-3.47 7.06-13.34 26.51-33.82 62z" fill="none"></path><path d="M372.66 279.16l-1 2a16.29 16.29 0 0 1 6.77-7.26a16.48 16.48 0 0 0-5.77 5.26z" fill="currentColor"></path><path d="M195.94 459.38C205.37 472.67 221 480 240 480a16 16 0 0 0 14.31-8.85c3-6.06 15.25-24 28.19-42.9c18-26.33 40.35-59.08 55.23-84.81l.13-.22c20.48-35.49 30.35-54.94 33.82-62l1-2a16.48 16.48 0 0 1 5.79-5.23A15.93 15.93 0 0 1 386 272h25.32A84.7 84.7 0 0 0 496 187.3v-38.6A84.7 84.7 0 0 0 411.31 64h-48.79a17.46 17.46 0 0 1-9.58-2.89C330 46.13 286.66 32 240 32c-7.45 0-14.19.14-20.27.38a8 8 0 0 0-6.2 12.68l.1.14C222.2 57.59 224 71 224 80a61.16 61.16 0 0 1-5.19 24.77a17.38 17.38 0 0 0 0 14.06a63.81 63.81 0 0 1 0 50.39a17.32 17.32 0 0 0 0 14a62.13 62.13 0 0 1 0 49.58a18.13 18.13 0 0 0 0 14.68A60.41 60.41 0 0 1 224 273c0 8.2-2 21.3-8 31.18a15.66 15.66 0 0 0-1.14 13.65c.38 1 .76 2.06 1.13 3.17a24.8 24.8 0 0 1 .86 11.57c-3 19.35-9.67 36.3-16.74 54.16c-3.08 7.78-6.27 15.82-9.22 24.27c-6.14 17.56-4.3 35.2 5.05 48.38z" fill="currentColor"></path>',5),nt=[st],it=_({name:"ThumbsDown",render:function(a,e){return p(),k("svg",ot,nt)}}),lt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ct=B('<path d="M192 53.84S208 48 256 48s74 16 96 32h64a64 64 0 0 1 64 64v48a64 64 0 0 1-64 64h-30a32.34 32.34 0 0 0-27.37 15.4S350 290.19 324 335.22S248 448 240 464c-29 0-43-22-34-47.71c10.28-29.39 23.71-54.38 27.46-87.09c.54-4.78-3.14-12-8-12L96 307" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M96 241l80 2c20 1.84 32 12.4 32 30h0c0 17.6-14 28.84-32 30l-80 4c-17.6 0-32-16.4-32-34v-.17A32 32 0 0 1 96 241z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M64 176l112 2c18 .84 32 12.41 32 30h0c0 17.61-14 28.86-32 30l-112 2a32.1 32.1 0 0 1-32-32h0a32.1 32.1 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M112 48l64 3c21 1.84 32 11.4 32 29h0c0 17.6-14.4 30-32 30l-64 2a32.09 32.09 0 0 1-32-32h0a32.09 32.09 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M80 112l96 2c19 .84 32 12.4 32 30h0c0 17.6-13 28.84-32 30l-96 2a32.09 32.09 0 0 1-32-32h0a32.09 32.09 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path>',5),ut=[ct],dt=_({name:"ThumbsDownOutline",render:function(a,e){return p(),k("svg",lt,ut)}}),ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},mt=B('<path d="M472.06 334l-144.16-6.13c-4.61-.36-23.9-1.21-23.9-25.87c0-23.81 19.16-25.33 24.14-25.88L472.06 270c12.67.13 23.94 14.43 23.94 32s-11.27 31.87-23.94 32zM330.61 202.33L437.35 194C450 194 464 210.68 464 227.88v.33c0 16.32-11.14 29.62-24.88 29.79l-108.45-1.73C304 253 304 236.83 304 229.88c0-22.88 21.8-27.15 26.61-27.55zM421.85 480l-89.37-8.93C308 470.14 304 453.82 304 443.59c0-18.38 13.41-24.6 26.67-24.6l91-3c14.54.23 26.32 14.5 26.32 32s-11.67 31.67-26.14 32.01zm34.36-71.5l-126.4-6.21c-9.39-.63-25.81-3-25.81-26.37c0-12 4.35-25.61 25-27.53l127.19-3.88c13.16.14 23.81 13.49 23.81 31.4s-10.65 32.43-23.79 32.58z" fill="currentColor"></path><path d="M133.55 238.06A15.85 15.85 0 0 1 126 240a15.82 15.82 0 0 0 7.51-1.92z" fill="none"></path><path d="M174.14 168.78l.13-.23l-.13.23c-20.5 35.51-30.36 54.95-33.82 62c3.47-7.07 13.34-26.51 33.82-62z" fill="none"></path><path d="M139.34 232.84l1-2a16.27 16.27 0 0 1-6.77 7.25a16.35 16.35 0 0 0 5.77-5.25z" fill="currentColor"></path><path d="M316.06 52.62C306.63 39.32 291 32 272 32a16 16 0 0 0-14.31 8.84c-3 6.07-15.25 24-28.19 42.91c-18 26.33-40.35 59.07-55.23 84.8l-.13.23c-20.48 35.49-30.35 54.93-33.82 62l-1 2a16.35 16.35 0 0 1-5.79 5.22a15.82 15.82 0 0 1-7.53 2h-25.31A84.69 84.69 0 0 0 16 324.69v38.61a84.69 84.69 0 0 0 84.69 84.7h48.79a17.55 17.55 0 0 1 9.58 2.89C182 465.87 225.34 480 272 480c7.45 0 14.19-.14 20.27-.38a8 8 0 0 0 6.2-12.68l-.1-.14C289.8 454.41 288 441 288 432a61.2 61.2 0 0 1 5.19-24.77a17.36 17.36 0 0 0 0-14.05a63.81 63.81 0 0 1 0-50.39a17.32 17.32 0 0 0 0-14a62.15 62.15 0 0 1 0-49.59a18.13 18.13 0 0 0 0-14.68A60.33 60.33 0 0 1 288 239c0-8.2 2-21.3 8-31.19a15.63 15.63 0 0 0 1.14-13.64c-.38-1-.76-2.07-1.13-3.17a24.84 24.84 0 0 1-.86-11.58c3-19.34 9.67-36.29 16.74-54.16c3.08-7.78 6.27-15.82 9.22-24.26c6.14-17.57 4.3-35.2-5.05-48.38z" fill="currentColor"></path>',5),pt=[mt],ft=_({name:"ThumbsUp",render:function(a,e){return p(),k("svg",ht,pt)}}),vt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},wt=B('<path d="M320 458.16S304 464 256 464s-74-16-96-32H96a64 64 0 0 1-64-64v-48a64 64 0 0 1 64-64h30a32.34 32.34 0 0 0 27.37-15.4S162 221.81 188 176.78S264 64 272 48c29 0 43 22 34 47.71c-10.28 29.39-23.71 54.38-27.46 87.09c-.54 4.78 3.14 12 7.95 12L416 205" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M416 271l-80-2c-20-1.84-32-12.4-32-30h0c0-17.6 14-28.84 32-30l80-4c17.6 0 32 16.4 32 34v.17A32 32 0 0 1 416 271z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M448 336l-112-2c-18-.84-32-12.41-32-30h0c0-17.61 14-28.86 32-30l112-2a32.1 32.1 0 0 1 32 32h0a32.1 32.1 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M400 464l-64-3c-21-1.84-32-11.4-32-29h0c0-17.6 14.4-30 32-30l64-2a32.09 32.09 0 0 1 32 32h0a32.09 32.09 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M432 400l-96-2c-19-.84-32-12.4-32-30h0c0-17.6 13-28.84 32-30l96-2a32.09 32.09 0 0 1 32 32h0a32.09 32.09 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path>',5),gt=[wt],yt=_({name:"ThumbsUpOutline",render:function(a,e){return p(),k("svg",vt,gt)}});function P(){let t=localStorage.getItem("visitor_fingerprint");return t||(t=crypto.randomUUID(),localStorage.setItem("visitor_fingerprint",t)),t}async function kt(t,a,e){const i=e?null:P();try{let o=x.from("restaurant_votes").select("id, vote_type").eq("restaurant_id",t);e?o=o.eq("user_id",e):o=o.eq("fingerprint",i);const{data:s,error:d}=await o;if(d)throw d;if(s&&s.length>0){const h=s[0];if(h.vote_type===a){const{error:c}=await x.from("restaurant_votes").delete().eq("id",h.id);if(c)throw c;return{action:"deleted"}}else{const{error:c}=await x.from("restaurant_votes").update({vote_type:a}).eq("id",h.id);if(c)throw c;return{action:"updated"}}}else{const{error:h}=await x.from("restaurant_votes").insert({restaurant_id:t,user_id:e||null,fingerprint:e?null:i,vote_type:a});if(h)throw h;return{action:"inserted"}}}catch(o){return console.error("Toggle vote error:",o),{error:o.message}}}async function _t(t){try{const{data:a,error:e}=await x.from("restaurant_votes").select("vote_type").eq("restaurant_id",t);if(e)throw e;const i=a.filter(s=>s.vote_type===1).length,o=a.filter(s=>s.vote_type===-1).length;return{upvotes:i,downvotes:o}}catch(a){return console.error("Get votes error:",a),{upvotes:0,downvotes:0}}}async function Ct(t,a){const e=a?null:P();try{let i=x.from("restaurant_votes").select("vote_type").eq("restaurant_id",t);a?i=i.eq("user_id",a):i=i.eq("fingerprint",e);const{data:o,error:s}=await i.maybeSingle();if(s)throw s;return o?o.vote_type:null}catch(i){return console.error("Get user vote error:",i),null}}const Mt={class:"vote-buttons"},xt=_({__name:"VoteButtons",props:{restaurantId:{},upvotes:{},downvotes:{},userVote:{}},emits:["update"],setup(t,{emit:a}){const e=t,i=a,o=R(),s=j(),d=$(e.upvotes||0),h=$(e.downvotes||0),c=$(e.userVote||null),y=$(!1);F(async()=>{e.upvotes===void 0&&f(),e.userVote===void 0&&n()});async function f(){const{upvotes:M,downvotes:v}=await _t(e.restaurantId);d.value=M,h.value=v}async function n(){var v;const M=await Ct(e.restaurantId,(v=o.user)==null?void 0:v.id);c.value=M}async function C(M){var v;if(!y.value){y.value=!0;try{const N=await kt(e.restaurantId,M,(v=o.user)==null?void 0:v.id);N.error?s.error(N.error):(await f(),await n(),i("update",{upvotes:d.value,downvotes:h.value,userVote:c.value}))}finally{y.value=!1}}}return(M,v)=>(p(),k("div",Mt,[m(r(V),{size:8},{default:l(()=>[m(r(b),{size:"tiny",secondary:"",round:"",type:c.value===1?"primary":"default",onClick:v[0]||(v[0]=q(N=>C(1),["stop"])),loading:y.value},{icon:l(()=>[(p(),z(I(c.value===1?r(ft):r(yt))))]),default:l(()=>[g(" "+w(d.value),1)]),_:1},8,["type","loading"]),m(r(b),{size:"tiny",secondary:"",round:"",type:c.value===-1?"error":"default",onClick:v[1]||(v[1]=q(N=>C(-1),["stop"])),loading:y.value},{icon:l(()=>[(p(),z(I(c.value===-1?r(it):r(dt))))]),default:l(()=>[g(" "+w(h.value),1)]),_:1},8,["type","loading"])]),_:1})]))}}),zt=A(xt,[["__scopeId","data-v-884cd64e"]]),$t={class:"navigate-button"},bt=_({__name:"NavigateButton",props:{address:{},latitude:{},longitude:{},size:{},quaternary:{type:Boolean},secondary:{type:Boolean},circle:{type:Boolean}},setup(t){const a=t,e=j();async function i(){O()?Y(a.address,a.latitude,a.longitude):await X(a.address)?e.success("åœ°å€å·²å¤åˆ¶ï¼Œè¯·åœ¨åœ°å›¾åº”ç”¨ä¸­ç²˜è´´æœç´¢"):e.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶")}return(o,s)=>(p(),k("div",$t,[r(O)()?(p(),z(r(b),{key:1,size:t.size||"small",quaternary:t.quaternary,secondary:t.secondary,circle:t.circle,type:"primary",onClick:q(i,["stop"])},{icon:l(()=>[m(r(L),null,{default:l(()=>[m(r(D))]),_:1})]),default:l(()=>[t.circle?S("",!0):E(o.$slots,"default",{key:0},()=>[s[2]||(s[2]=g("å¯¼èˆª",-1))],!0)]),_:3},8,["size","quaternary","secondary","circle"])):(p(),z(r(Z),{key:0,trigger:"hover"},{trigger:l(()=>[m(r(b),{size:t.size||"small",quaternary:t.quaternary,secondary:t.secondary,circle:t.circle,type:"primary",onClick:q(i,["stop"])},{icon:l(()=>[m(r(L),null,{default:l(()=>[m(r(D))]),_:1})]),default:l(()=>[t.circle?S("",!0):E(o.$slots,"default",{key:0},()=>[s[0]||(s[0]=g("åŽ»è¿™é‡Œ",-1))],!0)]),_:3},8,["size","quaternary","secondary","circle"])]),default:l(()=>[s[1]||(s[1]=g(" PCç«¯ç‚¹å‡»å¤åˆ¶åœ°å€ï¼Œè¯·æ‰“å¼€é«˜å¾·åœ°å›¾ç²˜è´´æœç´¢ ",-1))]),_:3}))]))}}),qt=A(bt,[["__scopeId","data-v-9a672588"]]);function Nt(t,a,e,i){const s=t*Math.PI/180,d=e*Math.PI/180,h=(e-t)*Math.PI/180,c=(i-a)*Math.PI/180,y=Math.sin(h/2)*Math.sin(h/2)+Math.cos(s)*Math.cos(d)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))}function Vt(t){return Math.round(t/(1.2*60))}const St={key:0,class:"card-image"},Bt=["src","alt"],Tt={class:"placeholder-emoji"},At={class:"card-content-wrapper"},It={class:"card-header"},Et={class:"info-row"},Lt={class:"info-item"},Ot={class:"info-icon"},Ut={class:"info-item price"},Dt=["title"],Rt={class:"info-row location"},jt={class:"address-text"},Pt={class:"recommendation-box"},Ft=_({__name:"RestaurantCard",props:{restaurant:{},userLocation:{}},emits:["update"],setup(t,{emit:a}){const e=t,i=R(),o=$(!1),s=T(()=>{var f;return((f=i.user)==null?void 0:f.id)===e.restaurant.created_by||i.isAdmin}),d=J[e.restaurant.tier],h=K[e.restaurant.category],c=T(()=>{if(!e.userLocation||!e.restaurant.latitude||!e.restaurant.longitude)return null;const f=Nt(e.userLocation.lat,e.userLocation.lng,e.restaurant.latitude,e.restaurant.longitude);return{meters:Math.round(f),text:f>1e3?`${(f/1e3).toFixed(1)}km`:`${Math.round(f)}m`,walkTime:Vt(f)}}),y=T(()=>({background:`linear-gradient(135deg, ${d.color}1a 0%, ${d.color}33 100%)`,borderBottom:`2px solid ${d.color}`}));return(f,n)=>(p(),z(r(G),{class:"restaurant-card",hoverable:"",bordered:!1},{cover:l(()=>[t.restaurant.image_url?(p(),k("div",St,[u("img",{src:t.restaurant.image_url,alt:t.restaurant.name,loading:"lazy"},null,8,Bt),n[3]||(n[3]=u("div",{class:"image-overlay"},null,-1))])):(p(),k("div",{key:1,class:"card-image-placeholder",style:Q(y.value)},[u("span",Tt,w(r(h).emoji),1)],4))]),default:l(()=>[u("div",At,[u("div",It,[m(r(U),{"line-clamp":2,tooltip:{width:280},class:"card-name"},{default:l(()=>[g(w(t.restaurant.name),1)]),_:1}),m(r(V),{size:4,align:"center"},{default:l(()=>[m(zt,{"restaurant-id":t.restaurant.id,upvotes:t.restaurant.upvotes,downvotes:t.restaurant.downvotes,"user-vote":t.restaurant.user_vote},null,8,["restaurant-id","upvotes","downvotes","user-vote"]),m(r(W),{color:{color:r(d).color+"1a",textColor:r(d).color,borderColor:r(d).color},bordered:!0,round:"",size:"small",class:"tier-tag"},{default:l(()=>[g(w(r(d).emoji)+" "+w(r(d).label),1)]),_:1},8,["color"])]),_:1})]),m(r(V),{vertical:"",size:6,class:"card-details"},{default:l(()=>[u("div",Et,[u("span",Lt,[u("span",Ot,w(r(h).emoji),1),g(" "+w(r(h).label),1)]),n[6]||(n[6]=u("span",{class:"separator"},"â€¢",-1)),u("span",Ut," Â¥"+w(t.restaurant.price_per_person)+"/äºº ",1),c.value?(p(),k(H,{key:0},[n[5]||(n[5]=u("span",{class:"separator"},"â€¢",-1)),u("span",{class:"info-item distance",title:"æ­¥è¡Œçº¦ "+c.value.walkTime+" åˆ†é’Ÿ"},[n[4]||(n[4]=u("span",{class:"info-icon"},"ðŸš¶",-1)),g(" "+w(c.value.text),1)],8,Dt)],64)):S("",!0)]),u("div",Rt,[n[8]||(n[8]=u("span",{class:"info-icon"},"ðŸ“",-1)),u("span",jt,w(t.restaurant.address),1),m(r(V),{size:4},{default:l(()=>[m(qt,{address:t.restaurant.address,latitude:t.restaurant.latitude,longitude:t.restaurant.longitude,quaternary:"",size:"tiny"},null,8,["address","latitude","longitude"]),s.value?(p(),z(r(b),{key:0,quaternary:"",size:"tiny",onClick:n[0]||(n[0]=q(C=>o.value=!0,["stop"]))},{default:l(()=>[...n[7]||(n[7]=[g(" ç¼–è¾‘ ",-1)])]),_:1})):S("",!0)]),_:1})]),u("div",Pt,[n[9]||(n[9]=u("span",{class:"quote-icon"},"â",-1)),m(r(U),{"line-clamp":2,tooltip:{}},{default:l(()=>[g(w(t.restaurant.recommendation||"æš‚æ— è¯„ä»·"),1)]),_:1})])]),_:1})]),m(tt,{show:o.value,"onUpdate:show":n[1]||(n[1]=C=>o.value=C),restaurant:t.restaurant,onSuccess:n[2]||(n[2]=C=>f.$emit("update"))},null,8,["show","restaurant"])]),_:1}))}}),Yt=A(Ft,[["__scopeId","data-v-7fa62a7e"]]);export{Yt as R,Nt as g};
