import{i as le,c as de,a as K,b as ce,d as ue,e as I,f as J,g as E,r as fe,h as F,j as me,V as ve,u as te,k as j,l as Q,m as $,n as W,o as ge,p as re,q as he,s as pe,t as se,w as be,v as ye,x as _e,y as ke,z as ze,A as xe,F as L,B as X,C as p,D as m,E as oe,G as v,H as U,I as H,J as g,K as _,L as M,M as V,N as s,O as Se,P as Y,Q as P,R as we,S as N}from"./index-C2Gp7NGW.js";import{u as Re,a as Ce,F as Oe}from"./useFilter-Doggg0fj.js";import{t as Pe,T as $e,N as Le}from"./index-Czy6U25M.js";import{_ as A,N as q,u as Be}from"./_plugin-vue_export-helper-CzhqH681.js";import{R as Fe}from"./RestaurantCard-R7s7auCC.js";import{i as je,o as Ee,S as Te}from"./RestaurantForm-BTEcBryE.js";import{N as Ne}from"./Dropdown-4CbJKzia.js";import"./Checkbox-wmc1j8VB.js";import"./RadioGroup-CcMq-gN0.js";import"./navigation-DUNkFvzQ.js";import"./EditRestaurantModal-DruVz4F-.js";import"./FormItem-4wSwW5g7.js";let Z=!1;function He(){if(le&&window.CSS&&!Z&&(Z=!0,"registerProperty"in(window==null?void 0:window.CSS)))try{CSS.registerProperty({name:"--n-color-start",syntax:"<color>",inherits:!1,initialValue:"#0000"}),CSS.registerProperty({name:"--n-color-end",syntax:"<color>",inherits:!1,initialValue:"#0000"})}catch{}}const Ie=de("n-avatar-group"),Ae=K("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[ce(I("&","--n-merged-color: var(--n-color-modal);")),ue(I("&","--n-merged-color: var(--n-color-popover);")),I("img",`
 width: 100%;
 height: 100%;
 `),J("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),K("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),J("text","line-height: 1.25")]),Me=Object.assign(Object.assign({},W.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),Ve=E({name:"Avatar",props:Me,slots:Object,setup(r){const{mergedClsPrefixRef:n,inlineThemeDisabled:o}=te(r),i=j(!1);let l=null;const u=j(null),d=j(null),b=()=>{const{value:t}=u;if(t&&(l===null||l!==t.innerHTML)){l=t.innerHTML;const{value:a}=d;if(a){const{offsetWidth:c,offsetHeight:h}=a,{offsetWidth:y,offsetHeight:T}=t,B=.9,D=Math.min(c/y*B,h/T*B,1);t.style.transform=`translateX(-50%) translateY(-50%) scale(${D})`}}},S=Q(Ie,null),z=$(()=>{const{size:t}=r;if(t)return t;const{size:a}=S||{};return a||"medium"}),w=W("Avatar","-avatar",Ae,ge,r,n),x=Q(Pe,null),k=$(()=>{if(S)return!0;const{round:t,circle:a}=r;return t!==void 0||a!==void 0?t||a:x?x.roundRef.value:!1}),R=$(()=>S?!0:r.bordered||!1),C=$(()=>{const t=z.value,a=k.value,c=R.value,{color:h}=r,{self:{borderRadius:y,fontSize:T,color:B,border:D,colorModal:ne,colorPopover:ae},common:{cubicBezierEaseInOut:ie}}=w.value;let G;return typeof t=="number"?G=`${t}px`:G=w.value.self[re("height",t)],{"--n-font-size":T,"--n-border":c?D:"none","--n-border-radius":a?"50%":y,"--n-color":h||B,"--n-color-modal":h||ne,"--n-color-popover":h||ae,"--n-bezier":ie,"--n-merged-size":`var(--n-avatar-size-override, ${G})`}}),e=o?he("avatar",$(()=>{const t=z.value,a=k.value,c=R.value,{color:h}=r;let y="";return t&&(typeof t=="number"?y+=`a${t}`:y+=t[0]),a&&(y+="b"),c&&(y+="c"),h&&(y+=pe(h)),y}),C,r):void 0,f=j(!r.lazy);se(()=>{if(r.lazy&&r.intersectionObserverOptions){let t;const a=be(()=>{t==null||t(),t=void 0,r.lazy&&(t=Ee(d.value,r.intersectionObserverOptions,f))});ye(()=>{a(),t==null||t()})}}),_e(()=>{var t;return r.src||((t=r.imgProps)===null||t===void 0?void 0:t.src)},()=>{i.value=!1});const O=j(!r.lazy);return{textRef:u,selfRef:d,mergedRoundRef:k,mergedClsPrefix:n,fitTextTransform:b,cssVars:o?void 0:C,themeClass:e==null?void 0:e.themeClass,onRender:e==null?void 0:e.onRender,hasLoadError:i,shouldStartLoading:f,loaded:O,mergedOnError:t=>{if(!f.value)return;i.value=!0;const{onError:a,imgProps:{onError:c}={}}=r;a==null||a(t),c==null||c(t)},mergedOnLoad:t=>{const{onLoad:a,imgProps:{onLoad:c}={}}=r;a==null||a(t),c==null||c(t),O.value=!0}}},render(){var r,n;const{$slots:o,src:i,mergedClsPrefix:l,lazy:u,onRender:d,loaded:b,hasLoadError:S,imgProps:z={}}=this;d==null||d();let w;const x=!b&&!S&&(this.renderPlaceholder?this.renderPlaceholder():(n=(r=this.$slots).placeholder)===null||n===void 0?void 0:n.call(r));return this.hasLoadError?w=this.renderFallback?this.renderFallback():fe(o.fallback,()=>[F("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):w=me(o.default,k=>{if(k)return F(ve,{onResize:this.fitTextTransform},{default:()=>F("span",{ref:"textRef",class:`${l}-avatar__text`},k)});if(i||z.src){const R=this.src||z.src;return F("img",Object.assign(Object.assign({},z),{loading:je&&!this.intersectionObserverOptions&&u?"lazy":"eager",src:u&&this.intersectionObserverOptions?this.shouldStartLoading?R:void 0:R,"data-image-src":R,onLoad:this.mergedOnLoad,onError:this.mergedOnError,style:[z.style||"",{objectFit:this.objectFit},x?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),F("span",{ref:"selfRef",class:[`${l}-avatar`,this.themeClass],style:this.cssVars},w,u&&x)}});function We(r){const{heightSmall:n,heightMedium:o,heightLarge:i,borderRadius:l}=r;return{color:"#eee",colorEnd:"#ddd",borderRadius:l,heightSmall:n,heightMedium:o,heightLarge:i}}const De={common:ke,self:We},Ge=I([K("skeleton",`
 height: 1em;
 width: 100%;
 transition:
 --n-color-start .3s var(--n-bezier),
 --n-color-end .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 animation: 2s skeleton-loading infinite cubic-bezier(0.36, 0, 0.64, 1);
 background-color: var(--n-color-start);
 `),I("@keyframes skeleton-loading",`
 0% {
 background: var(--n-color-start);
 }
 40% {
 background: var(--n-color-end);
 }
 80% {
 background: var(--n-color-start);
 }
 100% {
 background: var(--n-color-start);
 }
 `)]),Ke=Object.assign(Object.assign({},W.props),{text:Boolean,round:Boolean,circle:Boolean,height:[String,Number],width:[String,Number],size:String,repeat:{type:Number,default:1},animated:{type:Boolean,default:!0},sharp:{type:Boolean,default:!0}}),ee=E({name:"Skeleton",inheritAttrs:!1,props:Ke,setup(r){He();const{mergedClsPrefixRef:n}=te(r),o=W("Skeleton","-skeleton",Ge,De,r,n);return{mergedClsPrefix:n,style:$(()=>{var i,l;const u=o.value,{common:{cubicBezierEaseInOut:d}}=u,b=u.self,{color:S,colorEnd:z,borderRadius:w}=b;let x;const{circle:k,sharp:R,round:C,width:e,height:f,size:O,text:t,animated:a}=r;O!==void 0&&(x=b[re("height",O)]);const c=k?(i=e??f)!==null&&i!==void 0?i:x:e,h=(l=k?e??f:f)!==null&&l!==void 0?l:x;return{display:t?"inline-block":"",verticalAlign:t?"-0.125em":"",borderRadius:k?"50%":C?"4096px":R?"":w,width:typeof c=="number"?X(c):c,height:typeof h=="number"?X(h):h,animation:a?"":"none","--n-bezier":d,"--n-color-start":S,"--n-color-end":z}})}},render(){const{repeat:r,style:n,mergedClsPrefix:o,$attrs:i}=this,l=F("div",ze({class:`${o}-skeleton`,style:n},i));return r>1?F(L,null,xe(r,null).map(u=>[l,`
`])):l}}),qe={class:"label-content"},Ue={class:"tier-emoji"},Je={class:"tier-text"},Qe={key:0,class:"shine-effect"},Xe=E({__name:"TierLabel",props:{tier:{}},setup(r){const n=r,o=$(()=>$e[n.tier]);return(i,l)=>(m(),p("div",{class:oe(["tier-label-container",`tier-${r.tier}`])},[v("div",qe,[v("span",Ue,H(o.value.emoji),1),v("span",Je,H(o.value.label),1)]),r.tier==="hang"?(m(),p("div",Qe)):U("",!0)],2))}}),Ye=A(Xe,[["__scopeId","data-v-9c8e1b31"]]),Ze={class:"tier-content"},et={class:"card-list"},tt=E({__name:"TierRow",props:{tier:{},restaurants:{}},setup(r){return(n,o)=>(m(),p("div",{class:oe(["tier-row",`tier-row-${r.tier}`])},[g(Ye,{tier:r.tier},null,8,["tier"]),v("div",Ze,[g(s(Te),{"x-scrollable":""},{default:_(()=>[v("div",et,[(m(!0),p(L,null,M(r.restaurants,i=>(m(),V(Fe,{key:i.id,restaurant:i,class:"stagger-item"},null,8,["restaurant"]))),128))])]),_:1})])],2))}}),rt=A(tt,[["__scopeId","data-v-0087413a"]]),st={class:"tier-board"},ot={key:1,class:"global-empty-state"},nt=E({__name:"TierBoard",props:{restaurants:{}},setup(r){const n=r,o=$(()=>{const u={hang:[],top:[],elite:[],npc:[],la:[]};return n.restaurants.forEach(d=>{d.is_deleted||u[d.tier].push(d)}),u}),i=["hang","top","elite","npc","la"],l=$(()=>n.restaurants.length>0&&n.restaurants.some(u=>!u.is_deleted));return(u,d)=>(m(),p("div",st,[l.value?(m(),p(L,{key:0},M(i,b=>(m(),p(L,{key:b},[o.value[b].length>0?(m(),V(rt,{key:0,tier:b,restaurants:o.value[b]},null,8,["tier","restaurants"])):U("",!0)],64))),64)):(m(),p("div",ot,[...d[0]||(d[0]=[v("div",{class:"empty-content"},[v("span",{class:"empty-emoji"},"ðŸ½ï¸"),v("h3",null,"æš‚æ— ç¬¦åˆæ¡ä»¶çš„é¤åŽ…"),v("p",null,"æ¢ä¸ªç­›é€‰æ¡ä»¶è¯•è¯•ï¼Ÿ")],-1)])]))]))}}),at=A(nt,[["__scopeId","data-v-357695bb"]]),it={class:"loading-skeleton"},lt=E({__name:"LoadingSkeleton",setup(r){return(n,o)=>(m(),p("div",it,[(m(),p(L,null,M(5,i=>v("div",{key:i,class:"skeleton-tier-row"},[g(s(ee),{height:"200px",width:"120px"}),g(s(q),{class:"skeleton-cards"},{default:_(()=>[(m(),p(L,null,M(3,l=>g(s(ee),{key:l,height:"200px",width:"280px"})),64))]),_:1})])),64))]))}}),dt=A(lt,[["__scopeId","data-v-e917af04"]]),ct={class:"home-page"},ut={class:"page-header"},ft={class:"header-content"},mt={class:"user-avatar-wrapper"},vt={class:"user-nickname"},gt={class:"filter-sticky-wrapper"},ht={key:0,class:"filter-stats"},pt={class:"content"},bt=E({__name:"HomePage",setup(r){const n=we(),o=Se(),i=Be(),l=j(!0),u=Re(),d=j([]);se(async()=>{o.initialized||await o.initialize(),await b()});async function b(){var C;l.value=!0;try{const{data:e,error:f}=await Y.rpc("get_restaurants_with_votes",{user_uuid:((C=o.user)==null?void 0:C.id)||null});if(f){console.warn("RPC failed, falling back to simple query",f);const{data:O,error:t}=await Y.from("restaurants").select("*").eq("is_deleted",!1).order("created_at",{ascending:!1});if(t)throw t;d.value=O}else d.value=e;d.value.length>0?console.log("[HomePage] Loaded",d.value.length,"restaurants"):console.log("[HomePage] No restaurants in database")}catch(e){console.error("[HomePage] Failed to fetch restaurants:",e.message),i.error("åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"),d.value=[]}finally{l.value=!1}}const S=[{label:"ä¸ªäººè®¾ç½®",key:"profile"},{label:"é€€å‡ºç™»å½•",key:"logout"}],z=[{label:"ç®¡ç†åŽå°",key:"admin"},{type:"divider",key:"d1"},...S];async function w(C){switch(C){case"logout":const e=await o.signOut();e.success?(i.success("å·²é€€å‡ºç™»å½•"),n.push("/login")):i.error(e.message);break;case"admin":n.push("/admin");break;case"profile":i.info("ä¸ªäººè®¾ç½®åŠŸèƒ½å³å°†ä¸Šçº¿");break}}const{filteredRestaurants:x,filteredCount:k,totalCount:R}=Ce(d);return(C,e)=>(m(),p("div",ct,[v("header",ut,[v("div",ft,[e[11]||(e[11]=v("h1",{class:"page-title"},[v("span",{class:"title-emoji"},"ðŸœ"),P(" ç¾Žé£Ÿä»Žå¤¯åˆ°æ‹‰æŽ’è¡Œæ¦œ ")],-1)),g(s(q),null,{default:_(()=>[s(o).isAuthenticated?(m(),p(L,{key:1},[g(s(N),{type:"primary",onClick:e[2]||(e[2]=f=>s(n).push("/submit"))},{default:_(()=>[...e[8]||(e[8]=[P(" âœï¸ å½•å…¥ç¾Žé£Ÿ ",-1)])]),_:1}),g(s(N),{onClick:e[3]||(e[3]=f=>s(n).push("/map"))},{default:_(()=>[...e[9]||(e[9]=[P(" ðŸ—ºï¸ åœ°å›¾æ¨¡å¼ ",-1)])]),_:1}),g(s(N),{onClick:e[4]||(e[4]=f=>s(n).push("/random"))},{default:_(()=>[...e[10]||(e[10]=[P(" ðŸŽ² éšæœºé€‰é¤ ",-1)])]),_:1}),g(s(Ne),{options:s(o).isAdmin?z:S,onSelect:w},{default:_(()=>{var f,O,t,a,c;return[v("div",mt,[g(s(Ve),{round:"",size:"medium",src:(f=s(o).profile)==null?void 0:f.avatar_url,"fallback-src":"https://api.dicebear.com/7.x/avataaars/svg?seed="+((O=s(o).user)==null?void 0:O.email)},{default:_(()=>{var h,y,T,B;return[P(H(((y=(h=s(o).profile)==null?void 0:h.nickname)==null?void 0:y.charAt(0))||((B=(T=s(o).user)==null?void 0:T.email)==null?void 0:B.charAt(0))),1)]}),_:1},8,["src","fallback-src"]),v("span",vt,H(((t=s(o).profile)==null?void 0:t.nickname)||((c=(a=s(o).user)==null?void 0:a.email)==null?void 0:c.split("@")[0])),1)])]}),_:1},8,["options"])],64)):(m(),p(L,{key:0},[g(s(N),{onClick:e[0]||(e[0]=f=>s(n).push("/login"))},{default:_(()=>[...e[6]||(e[6]=[P(" ç™»å½• ",-1)])]),_:1}),g(s(N),{type:"primary",onClick:e[1]||(e[1]=f=>s(n).push("/register"))},{default:_(()=>[...e[7]||(e[7]=[P(" æ³¨å†Œ ",-1)])]),_:1})],64))]),_:1})])]),v("div",gt,[g(Oe)]),s(u).hasActiveFilters()?(m(),p("div",ht,[g(s(q),{align:"center"},{default:_(()=>[g(s(Le),{type:"info",size:"medium"},{default:_(()=>[P(" å·²ç­›é€‰: "+H(s(k))+" / "+H(s(R))+" å®¶ ",1)]),_:1}),g(s(N),{size:"small",secondary:"",onClick:e[5]||(e[5]=f=>s(u).resetFilters())},{default:_(()=>[...e[12]||(e[12]=[P(" ðŸ”„ æ¸…ç©ºç­›é€‰ ",-1)])]),_:1})]),_:1})])):U("",!0),v("div",pt,[l.value?(m(),V(dt,{key:0})):(m(),V(at,{key:1,restaurants:s(x)},null,8,["restaurants"]))])]))}}),Lt=A(bt,[["__scopeId","data-v-246d02b0"]]);export{Lt as default};
