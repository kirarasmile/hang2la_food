import{g as C,C as _,D as p,G as c,aR as B,P as M,O,k as z,t as F,J as m,N as r,K as l,S as V,aS as $,Q as k,I as w,M as x,aT as I,aU as E,H as S,m as T,ay as G,F as P,aV as H,ax as J}from"./index-C2Gp7NGW.js";import{a as L,T as K,C as Q,N as W}from"./index-Czy6U25M.js";import{u as R,N as q,_ as A}from"./_plugin-vue_export-helper-CzhqH681.js";import{i as U,o as Y,c as X}from"./navigation-DUNkFvzQ.js";import{N as Z}from"./RestaurantForm-BTEcBryE.js";import{N as tt,E as et}from"./EditRestaurantModal-DruVz4F-.js";const rt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ot=c("path",{d:"M448 64L64 240.14h200a8 8 0 0 1 8 8V448z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),at=[ot],D=C({name:"NavigateOutline",render:function(o,e){return p(),_("svg",rt,at)}}),nt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},st=B('<path d="M39.94 178l144.16 6.12c4.61.36 23.9 1.22 23.9 25.88c0 23.8-19.16 25.33-24.14 25.88L39.94 242C27.27 241.87 16 227.56 16 210s11.27-31.87 23.94-32zm141.45 131.66L74.65 318C62 318 48 301.31 48 284.12v-.33c0-16.33 11.14-29.63 24.88-29.79l108.45 1.72C208 259 208 275.16 208 282.12c0 22.88-21.8 27.14-26.61 27.54zM90.15 32l89.37 8.93C204 41.86 208 58.18 208 68.4c0 18.39-13.41 24.6-26.67 24.6l-91 3C75.78 95.78 64 81.51 64 64s11.68-31.66 26.15-32zm-34.36 71.5l126.4 6.22c9.39.63 25.81 3 25.81 26.36c0 12-4.35 25.62-25 27.53L55.79 167.5C42.65 167.35 32 154 32 136.08s10.65-32.43 23.79-32.58z" fill="currentColor"></path><path d="M378.45 273.93A15.84 15.84 0 0 1 386 272a15.93 15.93 0 0 0-7.51 1.91z" fill="none"></path><path d="M337.86 343.22l-.13.22a2.53 2.53 0 0 1 .13-.22c20.5-35.51 30.36-55 33.82-62c-3.47 7.06-13.34 26.51-33.82 62z" fill="none"></path><path d="M372.66 279.16l-1 2a16.29 16.29 0 0 1 6.77-7.26a16.48 16.48 0 0 0-5.77 5.26z" fill="currentColor"></path><path d="M195.94 459.38C205.37 472.67 221 480 240 480a16 16 0 0 0 14.31-8.85c3-6.06 15.25-24 28.19-42.9c18-26.33 40.35-59.08 55.23-84.81l.13-.22c20.48-35.49 30.35-54.94 33.82-62l1-2a16.48 16.48 0 0 1 5.79-5.23A15.93 15.93 0 0 1 386 272h25.32A84.7 84.7 0 0 0 496 187.3v-38.6A84.7 84.7 0 0 0 411.31 64h-48.79a17.46 17.46 0 0 1-9.58-2.89C330 46.13 286.66 32 240 32c-7.45 0-14.19.14-20.27.38a8 8 0 0 0-6.2 12.68l.1.14C222.2 57.59 224 71 224 80a61.16 61.16 0 0 1-5.19 24.77a17.38 17.38 0 0 0 0 14.06a63.81 63.81 0 0 1 0 50.39a17.32 17.32 0 0 0 0 14a62.13 62.13 0 0 1 0 49.58a18.13 18.13 0 0 0 0 14.68A60.41 60.41 0 0 1 224 273c0 8.2-2 21.3-8 31.18a15.66 15.66 0 0 0-1.14 13.65c.38 1 .76 2.06 1.13 3.17a24.8 24.8 0 0 1 .86 11.57c-3 19.35-9.67 36.3-16.74 54.16c-3.08 7.78-6.27 15.82-9.22 24.27c-6.14 17.56-4.3 35.2 5.05 48.38z" fill="currentColor"></path>',5),it=[st],lt=C({name:"ThumbsDown",render:function(o,e){return p(),_("svg",nt,it)}}),ct={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ut=B('<path d="M192 53.84S208 48 256 48s74 16 96 32h64a64 64 0 0 1 64 64v48a64 64 0 0 1-64 64h-30a32.34 32.34 0 0 0-27.37 15.4S350 290.19 324 335.22S248 448 240 464c-29 0-43-22-34-47.71c10.28-29.39 23.71-54.38 27.46-87.09c.54-4.78-3.14-12-8-12L96 307" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M96 241l80 2c20 1.84 32 12.4 32 30h0c0 17.6-14 28.84-32 30l-80 4c-17.6 0-32-16.4-32-34v-.17A32 32 0 0 1 96 241z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M64 176l112 2c18 .84 32 12.41 32 30h0c0 17.61-14 28.86-32 30l-112 2a32.1 32.1 0 0 1-32-32h0a32.1 32.1 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M112 48l64 3c21 1.84 32 11.4 32 29h0c0 17.6-14.4 30-32 30l-64 2a32.09 32.09 0 0 1-32-32h0a32.09 32.09 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M80 112l96 2c19 .84 32 12.4 32 30h0c0 17.6-13 28.84-32 30l-96 2a32.09 32.09 0 0 1-32-32h0a32.09 32.09 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path>',5),dt=[ut],ht=C({name:"ThumbsDownOutline",render:function(o,e){return p(),_("svg",ct,dt)}}),mt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},pt=B('<path d="M472.06 334l-144.16-6.13c-4.61-.36-23.9-1.21-23.9-25.87c0-23.81 19.16-25.33 24.14-25.88L472.06 270c12.67.13 23.94 14.43 23.94 32s-11.27 31.87-23.94 32zM330.61 202.33L437.35 194C450 194 464 210.68 464 227.88v.33c0 16.32-11.14 29.62-24.88 29.79l-108.45-1.73C304 253 304 236.83 304 229.88c0-22.88 21.8-27.15 26.61-27.55zM421.85 480l-89.37-8.93C308 470.14 304 453.82 304 443.59c0-18.38 13.41-24.6 26.67-24.6l91-3c14.54.23 26.32 14.5 26.32 32s-11.67 31.67-26.14 32.01zm34.36-71.5l-126.4-6.21c-9.39-.63-25.81-3-25.81-26.37c0-12 4.35-25.61 25-27.53l127.19-3.88c13.16.14 23.81 13.49 23.81 31.4s-10.65 32.43-23.79 32.58z" fill="currentColor"></path><path d="M133.55 238.06A15.85 15.85 0 0 1 126 240a15.82 15.82 0 0 0 7.51-1.92z" fill="none"></path><path d="M174.14 168.78l.13-.23l-.13.23c-20.5 35.51-30.36 54.95-33.82 62c3.47-7.07 13.34-26.51 33.82-62z" fill="none"></path><path d="M139.34 232.84l1-2a16.27 16.27 0 0 1-6.77 7.25a16.35 16.35 0 0 0 5.77-5.25z" fill="currentColor"></path><path d="M316.06 52.62C306.63 39.32 291 32 272 32a16 16 0 0 0-14.31 8.84c-3 6.07-15.25 24-28.19 42.91c-18 26.33-40.35 59.07-55.23 84.8l-.13.23c-20.48 35.49-30.35 54.93-33.82 62l-1 2a16.35 16.35 0 0 1-5.79 5.22a15.82 15.82 0 0 1-7.53 2h-25.31A84.69 84.69 0 0 0 16 324.69v38.61a84.69 84.69 0 0 0 84.69 84.7h48.79a17.55 17.55 0 0 1 9.58 2.89C182 465.87 225.34 480 272 480c7.45 0 14.19-.14 20.27-.38a8 8 0 0 0 6.2-12.68l-.1-.14C289.8 454.41 288 441 288 432a61.2 61.2 0 0 1 5.19-24.77a17.36 17.36 0 0 0 0-14.05a63.81 63.81 0 0 1 0-50.39a17.32 17.32 0 0 0 0-14a62.15 62.15 0 0 1 0-49.59a18.13 18.13 0 0 0 0-14.68A60.33 60.33 0 0 1 288 239c0-8.2 2-21.3 8-31.19a15.63 15.63 0 0 0 1.14-13.64c-.38-1-.76-2.07-1.13-3.17a24.84 24.84 0 0 1-.86-11.58c3-19.34 9.67-36.29 16.74-54.16c3.08-7.78 6.27-15.82 9.22-24.26c6.14-17.57 4.3-35.2-5.05-48.38z" fill="currentColor"></path>',5),ft=[pt],vt=C({name:"ThumbsUp",render:function(o,e){return p(),_("svg",mt,ft)}}),wt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},gt=B('<path d="M320 458.16S304 464 256 464s-74-16-96-32H96a64 64 0 0 1-64-64v-48a64 64 0 0 1 64-64h30a32.34 32.34 0 0 0 27.37-15.4S162 221.81 188 176.78S264 64 272 48c29 0 43 22 34 47.71c-10.28 29.39-23.71 54.38-27.46 87.09c-.54 4.78 3.14 12 7.95 12L416 205" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M416 271l-80-2c-20-1.84-32-12.4-32-30h0c0-17.6 14-28.84 32-30l80-4c17.6 0 32 16.4 32 34v.17A32 32 0 0 1 416 271z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M448 336l-112-2c-18-.84-32-12.41-32-30h0c0-17.61 14-28.86 32-30l112-2a32.1 32.1 0 0 1 32 32h0a32.1 32.1 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M400 464l-64-3c-21-1.84-32-11.4-32-29h0c0-17.6 14.4-30 32-30l64-2a32.09 32.09 0 0 1 32 32h0a32.09 32.09 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M432 400l-96-2c-19-.84-32-12.4-32-30h0c0-17.6 13-28.84 32-30l96-2a32.09 32.09 0 0 1 32 32h0a32.09 32.09 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path>',5),yt=[gt],kt=C({name:"ThumbsUpOutline",render:function(o,e){return p(),_("svg",wt,yt)}});function j(){let t=localStorage.getItem("visitor_fingerprint");return t||(t=crypto.randomUUID(),localStorage.setItem("visitor_fingerprint",t)),t}async function _t(t,o,e){const i=e?null:j();try{let a=M.from("restaurant_votes").select("id, vote_type").eq("restaurant_id",t);e?a=a.eq("user_id",e):a=a.eq("fingerprint",i);const{data:n,error:d}=await a;if(d)throw d;if(n&&n.length>0){const h=n[0];if(h.vote_type===o){const{error:u}=await M.from("restaurant_votes").delete().eq("id",h.id);if(u)throw u;return{action:"deleted"}}else{const{error:u}=await M.from("restaurant_votes").update({vote_type:o}).eq("id",h.id);if(u)throw u;return{action:"updated"}}}else{const{error:h}=await M.from("restaurant_votes").insert({restaurant_id:t,user_id:e||null,fingerprint:e?null:i,vote_type:o});if(h)throw h;return{action:"inserted"}}}catch(a){return console.error("Toggle vote error:",a),{error:a.message}}}async function Ct(t){try{const{data:o,error:e}=await M.from("restaurant_votes").select("vote_type").eq("restaurant_id",t);if(e)throw e;const i=o.filter(n=>n.vote_type===1).length,a=o.filter(n=>n.vote_type===-1).length;return{upvotes:i,downvotes:a}}catch(o){return console.error("Get votes error:",o),{upvotes:0,downvotes:0}}}async function Mt(t,o){const e=o?null:j();try{let i=M.from("restaurant_votes").select("vote_type").eq("restaurant_id",t);o?i=i.eq("user_id",o):i=i.eq("fingerprint",e);const{data:a,error:n}=await i.maybeSingle();if(n)throw n;return a?a.vote_type:null}catch(i){return console.error("Get user vote error:",i),null}}const xt={class:"vote-buttons"},zt=C({__name:"VoteButtons",props:{restaurantId:{},upvotes:{},downvotes:{},userVote:{}},emits:["update"],setup(t,{emit:o}){const e=t,i=o,a=O(),n=R(),d=z(e.upvotes||0),h=z(e.downvotes||0),u=z(e.userVote||null),g=z(!1);F(async()=>{e.upvotes===void 0&&f(),e.userVote===void 0&&s()});async function f(){const{upvotes:y,downvotes:v}=await Ct(e.restaurantId);d.value=y,h.value=v}async function s(){var v;const y=await Mt(e.restaurantId,(v=a.user)==null?void 0:v.id);u.value=y}async function b(y){var v;if(!g.value){g.value=!0;try{const N=await _t(e.restaurantId,y,(v=a.user)==null?void 0:v.id);N.error?n.error(N.error):(await f(),await s(),i("update",{upvotes:d.value,downvotes:h.value,userVote:u.value}))}finally{g.value=!1}}}return(y,v)=>(p(),_("div",xt,[m(r(q),{size:8},{default:l(()=>[m(r(V),{size:"tiny",secondary:"",round:"",type:u.value===1?"primary":"default",onClick:v[0]||(v[0]=$(N=>b(1),["stop"])),loading:g.value},{icon:l(()=>[(p(),x(I(u.value===1?r(vt):r(kt))))]),default:l(()=>[k(" "+w(d.value),1)]),_:1},8,["type","loading"]),m(r(V),{size:"tiny",secondary:"",round:"",type:u.value===-1?"error":"default",onClick:v[1]||(v[1]=$(N=>b(-1),["stop"])),loading:g.value},{icon:l(()=>[(p(),x(I(u.value===-1?r(lt):r(ht))))]),default:l(()=>[k(" "+w(h.value),1)]),_:1},8,["type","loading"])]),_:1})]))}}),$t=A(zt,[["__scopeId","data-v-884cd64e"]]),bt={class:"navigate-button"},Nt=C({__name:"NavigateButton",props:{address:{},latitude:{},longitude:{},size:{},quaternary:{type:Boolean},secondary:{type:Boolean},circle:{type:Boolean}},setup(t){const o=t,e=R();async function i(){U()?Y(o.address,o.latitude,o.longitude):await X(o.address)?e.success("åœ°å€å·²å¤åˆ¶ï¼Œè¯·åœ¨åœ°å›¾åº”ç”¨ä¸­ç²˜è´´æœç´¢"):e.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶")}return(a,n)=>(p(),_("div",bt,[r(U)()?(p(),x(r(V),{key:1,size:t.size||"small",quaternary:t.quaternary,secondary:t.secondary,circle:t.circle,type:"primary",onClick:$(i,["stop"])},{icon:l(()=>[m(r(L),null,{default:l(()=>[m(r(D))]),_:1})]),default:l(()=>[t.circle?S("",!0):E(a.$slots,"default",{key:0},()=>[n[2]||(n[2]=k("å¯¼èˆª",-1))],!0)]),_:3},8,["size","quaternary","secondary","circle"])):(p(),x(r(Z),{key:0,trigger:"hover"},{trigger:l(()=>[m(r(V),{size:t.size||"small",quaternary:t.quaternary,secondary:t.secondary,circle:t.circle,type:"primary",onClick:$(i,["stop"])},{icon:l(()=>[m(r(L),null,{default:l(()=>[m(r(D))]),_:1})]),default:l(()=>[t.circle?S("",!0):E(a.$slots,"default",{key:0},()=>[n[0]||(n[0]=k("åŽ»è¿™é‡Œ",-1))],!0)]),_:3},8,["size","quaternary","secondary","circle"])]),default:l(()=>[n[1]||(n[1]=k(" PCç«¯ç‚¹å‡»å¤åˆ¶åœ°å€ï¼Œè¯·æ‰“å¼€é«˜å¾·åœ°å›¾ç²˜è´´æœç´¢ ",-1))]),_:3}))]))}}),qt=A(Nt,[["__scopeId","data-v-9a672588"]]);function Vt(t,o,e,i){const n=t*Math.PI/180,d=e*Math.PI/180,h=(e-t)*Math.PI/180,u=(i-o)*Math.PI/180,g=Math.sin(h/2)*Math.sin(h/2)+Math.cos(n)*Math.cos(d)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))}function St(t){return Math.round(t/(1.2*60))}const Bt={key:0,class:"card-image"},Tt=["src","alt"],At={class:"placeholder-emoji"},It={class:"card-content-wrapper"},Et={class:"card-header"},Lt={class:"card-name"},Ut={class:"info-row"},Dt={class:"info-item"},Ot={class:"info-icon"},Rt={class:"info-item price"},jt=["title"],Ft={class:"info-row location"},Gt={class:"address-text"},Pt={class:"recommendation-box"},Ht=C({__name:"RestaurantCard",props:{restaurant:{},userLocation:{}},emits:["update"],setup(t,{emit:o}){const e=t,i=O(),a=z(!1),n=T(()=>{var f;return((f=i.user)==null?void 0:f.id)===e.restaurant.created_by||i.isAdmin}),d=K[e.restaurant.tier],h=Q[e.restaurant.category],u=T(()=>{if(!e.userLocation||!e.restaurant.latitude||!e.restaurant.longitude)return null;const f=Vt(e.userLocation.lat,e.userLocation.lng,e.restaurant.latitude,e.restaurant.longitude);return{meters:Math.round(f),text:f>1e3?`${(f/1e3).toFixed(1)}km`:`${Math.round(f)}m`,walkTime:St(f)}}),g=T(()=>({background:`linear-gradient(135deg, ${d.color}1a 0%, ${d.color}33 100%)`,borderBottom:`2px solid ${d.color}`}));return(f,s)=>{const b=H("NButton");return p(),x(r(G),{class:"restaurant-card",hoverable:"",bordered:!1},{cover:l(()=>[t.restaurant.image_url?(p(),_("div",Bt,[c("img",{src:t.restaurant.image_url,alt:t.restaurant.name,loading:"lazy"},null,8,Tt),s[3]||(s[3]=c("div",{class:"image-overlay"},null,-1))])):(p(),_("div",{key:1,class:"card-image-placeholder",style:J(g.value)},[c("span",At,w(r(h).emoji),1)],4))]),default:l(()=>[c("div",It,[c("div",Et,[c("h3",Lt,w(t.restaurant.name),1),m(r(q),{size:4,align:"center"},{default:l(()=>[m($t,{"restaurant-id":t.restaurant.id,upvotes:t.restaurant.upvotes,downvotes:t.restaurant.downvotes,"user-vote":t.restaurant.user_vote},null,8,["restaurant-id","upvotes","downvotes","user-vote"]),m(r(W),{color:{color:r(d).color+"1a",textColor:r(d).color,borderColor:r(d).color},bordered:!0,round:"",size:"small",class:"tier-tag"},{default:l(()=>[k(w(r(d).emoji)+" "+w(r(d).label),1)]),_:1},8,["color"])]),_:1})]),m(r(q),{vertical:"",size:6,class:"card-details"},{default:l(()=>[c("div",Ut,[c("span",Dt,[c("span",Ot,w(r(h).emoji),1),k(" "+w(r(h).label),1)]),s[6]||(s[6]=c("span",{class:"separator"},"â€¢",-1)),c("span",Rt," Â¥"+w(t.restaurant.price_per_person)+"/äºº ",1),u.value?(p(),_(P,{key:0},[s[5]||(s[5]=c("span",{class:"separator"},"â€¢",-1)),c("span",{class:"info-item distance",title:"æ­¥è¡Œçº¦ "+u.value.walkTime+" åˆ†é’Ÿ"},[s[4]||(s[4]=c("span",{class:"info-icon"},"ðŸš¶",-1)),k(" "+w(u.value.text),1)],8,jt)],64)):S("",!0)]),c("div",Ft,[s[8]||(s[8]=c("span",{class:"info-icon"},"ðŸ“",-1)),c("span",Gt,w(t.restaurant.address),1),m(r(q),{size:4},{default:l(()=>[m(qt,{address:t.restaurant.address,latitude:t.restaurant.latitude,longitude:t.restaurant.longitude,quaternary:"",size:"tiny"},null,8,["address","latitude","longitude"]),n.value?(p(),x(b,{key:0,quaternary:"",size:"tiny",onClick:s[0]||(s[0]=$(y=>a.value=!0,["stop"]))},{default:l(()=>[...s[7]||(s[7]=[k(" ç¼–è¾‘ ",-1)])]),_:1})):S("",!0)]),_:1})]),c("div",Pt,[s[9]||(s[9]=c("span",{class:"quote-icon"},"â",-1)),m(r(tt),{"line-clamp":2,tooltip:{}},{default:l(()=>[k(w(t.restaurant.recommendation||"æš‚æ— è¯„ä»·"),1)]),_:1})])]),_:1})]),m(et,{show:a.value,"onUpdate:show":s[1]||(s[1]=y=>a.value=y),restaurant:t.restaurant,onSuccess:s[2]||(s[2]=y=>f.$emit("update"))},null,8,["show","restaurant"])]),_:1})}}}),Zt=A(Ht,[["__scopeId","data-v-ab3742ff"]]);export{Zt as R,Vt as g};
