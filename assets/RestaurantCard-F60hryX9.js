import{g as _,C as g,D as d,G as c,aK as S,P as z,O as I,k as M,t as G,J as u,N as r,K as n,S as V,aL as $,Q as y,I as f,M as x,aM as T,aN as E,H as B,m as O,ay as F,aO as H,ax as K}from"./index-DsONrmNo.js";import{a as U,T as P,C as J,N as Q}from"./index-CR-Ma-hN.js";import{u as j,N as q,_ as A}from"./_plugin-vue_export-helper-CCO81CRs.js";import{i as D,o as Y,c as W}from"./navigation-DUNkFvzQ.js";import{N as X}from"./RestaurantForm-DP8lcWNC.js";import{N as Z,E as tt}from"./EditRestaurantModal-DmEcSU69.js";const et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},rt=c("path",{d:"M448 64L64 240.14h200a8 8 0 0 1 8 8V448z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),ot=[rt],L=_({name:"NavigateOutline",render:function(o,e){return d(),g("svg",et,ot)}}),at={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},st=S('<path d="M39.94 178l144.16 6.12c4.61.36 23.9 1.22 23.9 25.88c0 23.8-19.16 25.33-24.14 25.88L39.94 242C27.27 241.87 16 227.56 16 210s11.27-31.87 23.94-32zm141.45 131.66L74.65 318C62 318 48 301.31 48 284.12v-.33c0-16.33 11.14-29.63 24.88-29.79l108.45 1.72C208 259 208 275.16 208 282.12c0 22.88-21.8 27.14-26.61 27.54zM90.15 32l89.37 8.93C204 41.86 208 58.18 208 68.4c0 18.39-13.41 24.6-26.67 24.6l-91 3C75.78 95.78 64 81.51 64 64s11.68-31.66 26.15-32zm-34.36 71.5l126.4 6.22c9.39.63 25.81 3 25.81 26.36c0 12-4.35 25.62-25 27.53L55.79 167.5C42.65 167.35 32 154 32 136.08s10.65-32.43 23.79-32.58z" fill="currentColor"></path><path d="M378.45 273.93A15.84 15.84 0 0 1 386 272a15.93 15.93 0 0 0-7.51 1.91z" fill="none"></path><path d="M337.86 343.22l-.13.22a2.53 2.53 0 0 1 .13-.22c20.5-35.51 30.36-55 33.82-62c-3.47 7.06-13.34 26.51-33.82 62z" fill="none"></path><path d="M372.66 279.16l-1 2a16.29 16.29 0 0 1 6.77-7.26a16.48 16.48 0 0 0-5.77 5.26z" fill="currentColor"></path><path d="M195.94 459.38C205.37 472.67 221 480 240 480a16 16 0 0 0 14.31-8.85c3-6.06 15.25-24 28.19-42.9c18-26.33 40.35-59.08 55.23-84.81l.13-.22c20.48-35.49 30.35-54.94 33.82-62l1-2a16.48 16.48 0 0 1 5.79-5.23A15.93 15.93 0 0 1 386 272h25.32A84.7 84.7 0 0 0 496 187.3v-38.6A84.7 84.7 0 0 0 411.31 64h-48.79a17.46 17.46 0 0 1-9.58-2.89C330 46.13 286.66 32 240 32c-7.45 0-14.19.14-20.27.38a8 8 0 0 0-6.2 12.68l.1.14C222.2 57.59 224 71 224 80a61.16 61.16 0 0 1-5.19 24.77a17.38 17.38 0 0 0 0 14.06a63.81 63.81 0 0 1 0 50.39a17.32 17.32 0 0 0 0 14a62.13 62.13 0 0 1 0 49.58a18.13 18.13 0 0 0 0 14.68A60.41 60.41 0 0 1 224 273c0 8.2-2 21.3-8 31.18a15.66 15.66 0 0 0-1.14 13.65c.38 1 .76 2.06 1.13 3.17a24.8 24.8 0 0 1 .86 11.57c-3 19.35-9.67 36.3-16.74 54.16c-3.08 7.78-6.27 15.82-9.22 24.27c-6.14 17.56-4.3 35.2 5.05 48.38z" fill="currentColor"></path>',5),nt=[st],lt=_({name:"ThumbsDown",render:function(o,e){return d(),g("svg",at,nt)}}),it={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ct=S('<path d="M192 53.84S208 48 256 48s74 16 96 32h64a64 64 0 0 1 64 64v48a64 64 0 0 1-64 64h-30a32.34 32.34 0 0 0-27.37 15.4S350 290.19 324 335.22S248 448 240 464c-29 0-43-22-34-47.71c10.28-29.39 23.71-54.38 27.46-87.09c.54-4.78-3.14-12-8-12L96 307" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M96 241l80 2c20 1.84 32 12.4 32 30h0c0 17.6-14 28.84-32 30l-80 4c-17.6 0-32-16.4-32-34v-.17A32 32 0 0 1 96 241z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M64 176l112 2c18 .84 32 12.41 32 30h0c0 17.61-14 28.86-32 30l-112 2a32.1 32.1 0 0 1-32-32h0a32.1 32.1 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M112 48l64 3c21 1.84 32 11.4 32 29h0c0 17.6-14.4 30-32 30l-64 2a32.09 32.09 0 0 1-32-32h0a32.09 32.09 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M80 112l96 2c19 .84 32 12.4 32 30h0c0 17.6-13 28.84-32 30l-96 2a32.09 32.09 0 0 1-32-32h0a32.09 32.09 0 0 1 32-32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path>',5),ut=[ct],dt=_({name:"ThumbsDownOutline",render:function(o,e){return d(),g("svg",it,ut)}}),ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},mt=S('<path d="M472.06 334l-144.16-6.13c-4.61-.36-23.9-1.21-23.9-25.87c0-23.81 19.16-25.33 24.14-25.88L472.06 270c12.67.13 23.94 14.43 23.94 32s-11.27 31.87-23.94 32zM330.61 202.33L437.35 194C450 194 464 210.68 464 227.88v.33c0 16.32-11.14 29.62-24.88 29.79l-108.45-1.73C304 253 304 236.83 304 229.88c0-22.88 21.8-27.15 26.61-27.55zM421.85 480l-89.37-8.93C308 470.14 304 453.82 304 443.59c0-18.38 13.41-24.6 26.67-24.6l91-3c14.54.23 26.32 14.5 26.32 32s-11.67 31.67-26.14 32.01zm34.36-71.5l-126.4-6.21c-9.39-.63-25.81-3-25.81-26.37c0-12 4.35-25.61 25-27.53l127.19-3.88c13.16.14 23.81 13.49 23.81 31.4s-10.65 32.43-23.79 32.58z" fill="currentColor"></path><path d="M133.55 238.06A15.85 15.85 0 0 1 126 240a15.82 15.82 0 0 0 7.51-1.92z" fill="none"></path><path d="M174.14 168.78l.13-.23l-.13.23c-20.5 35.51-30.36 54.95-33.82 62c3.47-7.07 13.34-26.51 33.82-62z" fill="none"></path><path d="M139.34 232.84l1-2a16.27 16.27 0 0 1-6.77 7.25a16.35 16.35 0 0 0 5.77-5.25z" fill="currentColor"></path><path d="M316.06 52.62C306.63 39.32 291 32 272 32a16 16 0 0 0-14.31 8.84c-3 6.07-15.25 24-28.19 42.91c-18 26.33-40.35 59.07-55.23 84.8l-.13.23c-20.48 35.49-30.35 54.93-33.82 62l-1 2a16.35 16.35 0 0 1-5.79 5.22a15.82 15.82 0 0 1-7.53 2h-25.31A84.69 84.69 0 0 0 16 324.69v38.61a84.69 84.69 0 0 0 84.69 84.7h48.79a17.55 17.55 0 0 1 9.58 2.89C182 465.87 225.34 480 272 480c7.45 0 14.19-.14 20.27-.38a8 8 0 0 0 6.2-12.68l-.1-.14C289.8 454.41 288 441 288 432a61.2 61.2 0 0 1 5.19-24.77a17.36 17.36 0 0 0 0-14.05a63.81 63.81 0 0 1 0-50.39a17.32 17.32 0 0 0 0-14a62.15 62.15 0 0 1 0-49.59a18.13 18.13 0 0 0 0-14.68A60.33 60.33 0 0 1 288 239c0-8.2 2-21.3 8-31.19a15.63 15.63 0 0 0 1.14-13.64c-.38-1-.76-2.07-1.13-3.17a24.84 24.84 0 0 1-.86-11.58c3-19.34 9.67-36.29 16.74-54.16c3.08-7.78 6.27-15.82 9.22-24.26c6.14-17.57 4.3-35.2-5.05-48.38z" fill="currentColor"></path>',5),pt=[mt],vt=_({name:"ThumbsUp",render:function(o,e){return d(),g("svg",ht,pt)}}),ft={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},wt=S('<path d="M320 458.16S304 464 256 464s-74-16-96-32H96a64 64 0 0 1-64-64v-48a64 64 0 0 1 64-64h30a32.34 32.34 0 0 0 27.37-15.4S162 221.81 188 176.78S264 64 272 48c29 0 43 22 34 47.71c-10.28 29.39-23.71 54.38-27.46 87.09c-.54 4.78 3.14 12 7.95 12L416 205" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path d="M416 271l-80-2c-20-1.84-32-12.4-32-30h0c0-17.6 14-28.84 32-30l80-4c17.6 0 32 16.4 32 34v.17A32 32 0 0 1 416 271z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M448 336l-112-2c-18-.84-32-12.41-32-30h0c0-17.61 14-28.86 32-30l112-2a32.1 32.1 0 0 1 32 32h0a32.1 32.1 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M400 464l-64-3c-21-1.84-32-11.4-32-29h0c0-17.6 14.4-30 32-30l64-2a32.09 32.09 0 0 1 32 32h0a32.09 32.09 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path><path d="M432 400l-96-2c-19-.84-32-12.4-32-30h0c0-17.6 13-28.84 32-30l96-2a32.09 32.09 0 0 1 32 32h0a32.09 32.09 0 0 1-32 32z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"></path>',5),gt=[wt],yt=_({name:"ThumbsUpOutline",render:function(o,e){return d(),g("svg",ft,gt)}});function R(){let t=localStorage.getItem("visitor_fingerprint");return t||(t=crypto.randomUUID(),localStorage.setItem("visitor_fingerprint",t)),t}async function _t(t,o,e){const l=e?null:R();try{let a=z.from("restaurant_votes").select("id, vote_type").eq("restaurant_id",t);e?a=a.eq("user_id",e):a=a.eq("fingerprint",l);const{data:s,error:h}=await a;if(h)throw h;if(s&&s.length>0){const m=s[0];if(m.vote_type===o){const{error:p}=await z.from("restaurant_votes").delete().eq("id",m.id);if(p)throw p;return{action:"deleted"}}else{const{error:p}=await z.from("restaurant_votes").update({vote_type:o}).eq("id",m.id);if(p)throw p;return{action:"updated"}}}else{const{error:m}=await z.from("restaurant_votes").insert({restaurant_id:t,user_id:e||null,fingerprint:e?null:l,vote_type:o});if(m)throw m;return{action:"inserted"}}}catch(a){return console.error("Toggle vote error:",a),{error:a.message}}}async function kt(t){try{const{data:o,error:e}=await z.from("restaurant_votes").select("vote_type").eq("restaurant_id",t);if(e)throw e;const l=o.filter(s=>s.vote_type===1).length,a=o.filter(s=>s.vote_type===-1).length;return{upvotes:l,downvotes:a}}catch(o){return console.error("Get votes error:",o),{upvotes:0,downvotes:0}}}async function Ct(t,o){const e=o?null:R();try{let l=z.from("restaurant_votes").select("vote_type").eq("restaurant_id",t);o?l=l.eq("user_id",o):l=l.eq("fingerprint",e);const{data:a,error:s}=await l.maybeSingle();if(s)throw s;return a?a.vote_type:null}catch(l){return console.error("Get user vote error:",l),null}}const zt={class:"vote-buttons"},xt=_({__name:"VoteButtons",props:{restaurantId:{},upvotes:{},downvotes:{},userVote:{}},emits:["update"],setup(t,{emit:o}){const e=t,l=o,a=I(),s=j(),h=M(e.upvotes||0),m=M(e.downvotes||0),p=M(e.userVote||null),w=M(!1);G(async()=>{e.upvotes===void 0&&i(),e.userVote===void 0&&N()});async function i(){const{upvotes:C,downvotes:v}=await kt(e.restaurantId);h.value=C,m.value=v}async function N(){var v;const C=await Ct(e.restaurantId,(v=a.user)==null?void 0:v.id);p.value=C}async function k(C){var v;if(!w.value){w.value=!0;try{const b=await _t(e.restaurantId,C,(v=a.user)==null?void 0:v.id);b.error?s.error(b.error):(await i(),await N(),l("update",{upvotes:h.value,downvotes:m.value,userVote:p.value}))}finally{w.value=!1}}}return(C,v)=>(d(),g("div",zt,[u(r(q),{size:8},{default:n(()=>[u(r(V),{size:"tiny",secondary:"",round:"",type:p.value===1?"primary":"default",onClick:v[0]||(v[0]=$(b=>k(1),["stop"])),loading:w.value},{icon:n(()=>[(d(),x(T(p.value===1?r(vt):r(yt))))]),default:n(()=>[y(" "+f(h.value),1)]),_:1},8,["type","loading"]),u(r(V),{size:"tiny",secondary:"",round:"",type:p.value===-1?"error":"default",onClick:v[1]||(v[1]=$(b=>k(-1),["stop"])),loading:w.value},{icon:n(()=>[(d(),x(T(p.value===-1?r(lt):r(dt))))]),default:n(()=>[y(" "+f(m.value),1)]),_:1},8,["type","loading"])]),_:1})]))}}),Mt=A(xt,[["__scopeId","data-v-884cd64e"]]),$t={class:"navigate-button"},Nt=_({__name:"NavigateButton",props:{address:{},latitude:{},longitude:{},size:{},quaternary:{type:Boolean},secondary:{type:Boolean},circle:{type:Boolean}},setup(t){const o=t,e=j();async function l(){D()?Y(o.address,o.latitude,o.longitude):await W(o.address)?e.success("åœ°å€å·²å¤åˆ¶ï¼Œè¯·åœ¨åœ°å›¾åº”ç”¨ä¸­ç²˜è´´æœç´¢"):e.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶")}return(a,s)=>(d(),g("div",$t,[r(D)()?(d(),x(r(V),{key:1,size:t.size||"small",quaternary:t.quaternary,secondary:t.secondary,circle:t.circle,type:"primary",onClick:$(l,["stop"])},{icon:n(()=>[u(r(U),null,{default:n(()=>[u(r(L))]),_:1})]),default:n(()=>[t.circle?B("",!0):E(a.$slots,"default",{key:0},()=>[s[2]||(s[2]=y("å¯¼èˆª",-1))],!0)]),_:3},8,["size","quaternary","secondary","circle"])):(d(),x(r(X),{key:0,trigger:"hover"},{trigger:n(()=>[u(r(V),{size:t.size||"small",quaternary:t.quaternary,secondary:t.secondary,circle:t.circle,type:"primary",onClick:$(l,["stop"])},{icon:n(()=>[u(r(U),null,{default:n(()=>[u(r(L))]),_:1})]),default:n(()=>[t.circle?B("",!0):E(a.$slots,"default",{key:0},()=>[s[0]||(s[0]=y("åŽ»è¿™é‡Œ",-1))],!0)]),_:3},8,["size","quaternary","secondary","circle"])]),default:n(()=>[s[1]||(s[1]=y(" PCç«¯ç‚¹å‡»å¤åˆ¶åœ°å€ï¼Œè¯·æ‰“å¼€é«˜å¾·åœ°å›¾ç²˜è´´æœç´¢ ",-1))]),_:3}))]))}}),bt=A(Nt,[["__scopeId","data-v-9a672588"]]),qt={key:0,class:"card-image"},Vt=["src","alt"],Bt={class:"placeholder-emoji"},St={class:"card-content-wrapper"},At={class:"card-header"},Tt={class:"card-name"},Et={class:"info-row"},Ot={class:"info-item"},Ut={class:"info-icon"},Dt={class:"info-item price"},Lt={class:"info-row location"},It={class:"address-text"},jt={key:0,class:"recommendation-box"},Rt=_({__name:"RestaurantCard",props:{restaurant:{}},emits:["update"],setup(t,{emit:o}){const e=t,l=I(),a=M(!1),s=O(()=>{var w;return((w=l.user)==null?void 0:w.id)===e.restaurant.created_by||l.isAdmin}),h=P[e.restaurant.tier],m=J[e.restaurant.category],p=O(()=>({background:`linear-gradient(135deg, ${h.color}1a 0%, ${h.color}33 100%)`,borderBottom:`2px solid ${h.color}`}));return(w,i)=>{const N=H("NButton");return d(),x(r(F),{class:"restaurant-card",hoverable:"",bordered:!1},{cover:n(()=>[t.restaurant.image_url?(d(),g("div",qt,[c("img",{src:t.restaurant.image_url,alt:t.restaurant.name,loading:"lazy"},null,8,Vt),i[3]||(i[3]=c("div",{class:"image-overlay"},null,-1))])):(d(),g("div",{key:1,class:"card-image-placeholder",style:K(p.value)},[c("span",Bt,f(r(m).emoji),1)],4))]),default:n(()=>[c("div",St,[c("div",At,[c("h3",Tt,f(t.restaurant.name),1),u(r(q),{size:4,align:"center"},{default:n(()=>[u(Mt,{"restaurant-id":t.restaurant.id,upvotes:t.restaurant.upvotes,downvotes:t.restaurant.downvotes,"user-vote":t.restaurant.user_vote},null,8,["restaurant-id","upvotes","downvotes","user-vote"]),u(r(Q),{color:{color:r(h).color+"1a",textColor:r(h).color,borderColor:r(h).color},bordered:!0,round:"",size:"small",class:"tier-tag"},{default:n(()=>[y(f(r(h).emoji)+" "+f(r(h).label),1)]),_:1},8,["color"])]),_:1})]),u(r(q),{vertical:"",size:6,class:"card-details"},{default:n(()=>[c("div",Et,[c("span",Ot,[c("span",Ut,f(r(m).emoji),1),y(" "+f(r(m).label),1)]),i[4]||(i[4]=c("span",{class:"separator"},"â€¢",-1)),c("span",Dt," Â¥"+f(t.restaurant.price_per_person)+"/äºº ",1)]),c("div",Lt,[i[6]||(i[6]=c("span",{class:"info-icon"},"ðŸ“",-1)),c("span",It,f(t.restaurant.address),1),u(r(q),{size:4},{default:n(()=>[u(bt,{address:t.restaurant.address,latitude:t.restaurant.latitude,longitude:t.restaurant.longitude,quaternary:"",size:"tiny"},null,8,["address","latitude","longitude"]),s.value?(d(),x(N,{key:0,quaternary:"",size:"tiny",onClick:i[0]||(i[0]=$(k=>a.value=!0,["stop"]))},{default:n(()=>[...i[5]||(i[5]=[y(" ç¼–è¾‘ ",-1)])]),_:1})):B("",!0)]),_:1})]),t.restaurant.recommendation?(d(),g("div",jt,[i[7]||(i[7]=c("span",{class:"quote-icon"},"â",-1)),u(r(Z),{"line-clamp":2,tooltip:!1},{default:n(()=>[y(f(t.restaurant.recommendation),1)]),_:1})])):B("",!0)]),_:1})]),u(tt,{show:a.value,"onUpdate:show":i[1]||(i[1]=k=>a.value=k),restaurant:t.restaurant,onSuccess:i[2]||(i[2]=k=>w.$emit("update"))},null,8,["show","restaurant"])]),_:1})}}}),Qt=A(Rt,[["__scopeId","data-v-3529224c"]]);export{Qt as R};
